<html lang="en-US">

<head>
<meta charset="UTF-8">

<title>SOLVE - Mechanics of Machines Lab - Governor </title>
<link rel="stylesheet" href="css/MOMstyle.css" />
<script type="text/javascript" src= "js/jquery.min.js"></script>
<script type="text/javascript" src= "js/jquery-ui.min.js"></script>
<script type="text/javascript" src= "js/MOMscript.js"></script>
<script src="js/graph.ob.js"></script>
<script src="js/graph_use.ob.js"></script>
<script src="js/graph_use2.ob.js"></script>
<link href="css/mathstyle.css" rel="stylesheet" />
</head>

<body onload="editcss(); startsim(); varinit();printcomment();">

<noscript>
The simulation requires JavaScript to be enabled.
</noscript>

<div id="container">
<div id="simtitle">Porter Governor</div>
	<canvas id="simscreen" height="400px" width="550px"></canvas>
	<p id="fb"style="position:absolute; left: 340px; top: 90px;font-size: 24px; font-family: Times New Roman;">Free Body Diagram</p>
	<p id="eqn"style="position:absolute; left: 380px; top: 90px;font-size: 24px; font-family: Times New Roman;visibility:hidden">N<sup>2</sup> &alpha; <span class="frac"><sup>1</sup><span>&frasl;</span><sub>h</sub></span></p><!--Used mathstyle.css file to display equation-->
	<img src="images/PorterFBD.png" id="myImg" style="position:absolute; left: 280px; top: 120px; height:380px"/>
	<div id="graph" style="position: absolute;left:280px; top: 180px;width:300px;height:300px"></div>
</div>
<div id="titleincanvas"></div>

<div id="commentboxleft"></div>

<div id="vartitle">VARIABLES</div>

<div id="variables">
  <div id = "mset" class="variable">
    <div class="varname"><p title="Input Angular Velocity">n(rpm)&nbsp;</p>
    <input id="nspinner"></input></div>
    <div id="nslider"></div>
  </div>

  <div id = "nset" class="variable">
    <div class="varname"><p title="Height of the Governor">Height(mm)&nbsp; </p>
    <input id="hval" type="textbox" style="background-color:white;width:60px;color:black" disabled></input></div>
  </div>
</div>


<div id="ctrltitle">CONTROLS</div>
<div id="controls">
	<div class="usercheck">
      <input type="checkbox" id="cb" onclick="drawgraphh();" /><p>Show Graph</p><!-- Checkbox to display graph-->
	</div>
</div>

<div id="copyright" title="Developer : Bijay Swarnkar"> Copyright &copy; SOLVE The Virtual Lab @ NITK Surathkal </div>

</div>
<script type="text/javascript">

var simstatus=0; 
var rotstatus=1;

var commenttext="Some Text";
var commentloc=0;

var trans= new point(150,100);
var transa= new point(150,230);
var transaa= new point(200,400);


var y= new point(0,0,"y");
var z= new point(0,0,"z");
var o= new point(0,0," ");
var a= new point(0,0," ");
var b= new point(0,0," ");
var d= new point(0,0,"d");
var c= new point(0,0,"c");
var c1= new point(0,0,"");
var c2= new point(0,0,"");
var e= new point(0,0," ");
var f= new point(0,0," ");
var ii= new point(0,0,"ii");
var k= new point(0,0,"k");
var l= new point(0,0,"S");
var v= new point(0,0,"v");
var va= new point(0,0,"va");

var h1=0;
var om1=0;
var theta = 0;
var omega=0;;
var r=0;
var h=0;
var m=4;
var m1=20;
var r1=0;
var g=0;
var r2=0;
var r3=0;
var n=130;

var canvas = document.getElementById("simscreen");
var ctx = canvas.getContext("2d");
//Array to hold datapoints to plot graph
var datapoints1 = [];

//rotation variables
var gr = 0;


var time=0;


function editcss()
{
$('.variable').css('padding-top','30px');
$('.usercheck').css('left','40px');
<!-- $('#legend').css("width",document.getElementById('legendimg').width+"px"); -->
<!-- $('#legend').css("top",419); -->
<!-- $('#legend').css("left",342); -->
$('#container').css("top",0);
$('#container').css("left",0);
<!-- $('#legendicon').css("top",471); -->
}

function startsim()
{
 simTimeId=setInterval("time=time+0.6; varupdate(); ",'100');
}

function varinit()
{
	varchange();		
	$('#nslider').slider("value", 130);	
	$('#nspinner').spinner("value", 130);
}

function varchange()
{
	//Variable omega2 slider and number input types
	$('#nslider').slider({ max : 230, min : 130, step : 2 });		// slider initialisation : jQuery widget
	$('#nspinner').spinner({ max : 230, min : 130, step : 2 });		// number initialisation : jQuery widget			
	// monitoring change in value and connecting slider and number
	// setting trace point coordinate arrays to empty on change of link length
	$( "#nslider" ).on( "slide", function( e, ui ) { $('#nspinner').spinner("value",ui.value);});
	$( "#nspinner" ).on( "spin", function( e, ui ) { $('#nslider').slider("value",ui.value);});
	$( "#nspinner" ).on( "change", function() {  varchange();});	
	varupdate();
}

function varupdate()
{
	n=$('#nspinner').spinner("value");
	omega=(2*3.14*n)/600;
	theta=theta+(rotstatus*0.6*deg(omega));
	theta=theta%360;
	if(theta<0)theta+=360;
	h=(m+m1)*9.81/(omega*omega*m);
	g=(80*80)-(h*h);
	r1= Math.sqrt(g);
	r2= r1*Math.cos(rad(theta));
	r3= 10*Math.cos(rad(theta));
	o.xcoord=0;
	o.ycoord=0;
	z.xcoord=10*Math.cos(rad(theta));
	z.ycoord=10*Math.sin(rad(theta));
	y.xcoord=-10*Math.cos(rad(theta));
	y.ycoord=-10*Math.sin(rad(theta));
	c.xcoord=0;
	c.ycoord=0;
	c1.xcoord=8*Math.cos(rad(theta));
	c1.ycoord=0;
	c2.xcoord=-8*Math.cos(rad(theta));
	c2.ycoord=0;
	d.xcoord=0;
	e.xcoord=r2;
	e.ycoord=-h;
	f.xcoord=-r2;
	f.ycoord=-h;
	d.ycoord=-2*h;
	ii.xcoord=r3;
	ii.ycoord=-2*h;
	k.xcoord=-r3;
	k.ycoord=-2*h;
	l.xcoord=0;
	l.ycoord=-2*h-30;
	v.xcoord=r3
	v.ycoord=-2*h-30;
	va.xcoord=-r3;
	va.ycoord=-2*h-30;
	a.xcoord=r1*Math.cos(rad(theta));
	a.ycoord=r1*Math.sin(rad(theta));
	b.xcoord=-r1*Math.cos(rad(theta));
	b.ycoord=-r1*Math.sin(rad(theta));
	document.getElementById("hval").value = ((h*10)/2).toFixed(3);//To update the height field as per the updated n value
	draw();
}

function draw()
{
  ctx.clearRect(0,0,550,400);  //clears the complete canvas#simscreen everytime
  
  pointtrans(o,trans);
  pointtrans(b,trans);
  pointtrans(a,trans);
  pointtrans(z,trans);
  pointtrans(y,trans);
  pointtrans(c,transa);
  pointtrans(c1,transa);
  pointtrans(c2,transa);
  pointtrans(d,transa);
  pointtrans(e,transa);
  pointtrans(f,transa);
  pointtrans(ii,transa);
  pointtrans(k,transa);
  pointtrans(l,transa);
  pointtrans(v,transa);
  pointtrans(va,transa);
 
  
  ctx.beginPath();
  ctx.closePath();
  ctx.beginPath();
  ctx.lineWidth=1;
  ctx.strokeStyle= "#666666";
  //ctx.setLineDash([5, 15]);
  
  ctx.moveTo(150,o.xcoord);
  ctx.lineTo(150,-400);
  ctx.lineTo(150,400);
  ctx.moveTo(150,200);
  ctx.lineTo(50,200);
  ctx.lineTo(250,200);
  ctx.stroke();
  ctx.closePath();
  
//Pivot and centre 
  pointjoin(o,a,ctx,"#0885d8",5);
  pointjoin(o,b,ctx,"#0885d8",5);
  pointdisp(b,ctx,10,'#8e020c','#8e020c' );
  pointdisp(a,ctx,10,'#8e020c','#8e020c');
  pointjoin(z,y,ctx,"#181819",20);
  pointjoin(c,d,ctx,"#181819",5);
  pointjoin(c,e,ctx,"#0885d8",5);
  pointjoin(c,f,ctx,"#0885d8",5);
  pointjoin(c,c1,ctx,"#181819",15);
  pointjoin(c,c2,ctx,"#181819",15);
  pointdisp(f,ctx,10,'#8e020c','#8e020c');
  pointdisp(e,ctx,10,'#8e020c','#8e020c');
  pointjoin(e,ii,ctx,"#0885d8",5);
  pointjoin(f,k,ctx,"#0885d8",5);
  pointjoin(ii,k,ctx,"#e5791b",20);
  pointjoin(d,l,ctx,"#e5791b",10);
  pointjoin(v,va,ctx,"#e5791b",10);
  pointdisp(l,ctx,6,"","",'','','');
}
//This function used for plotting graph
	function drawgraphh()
	{
		document.getElementById("graph").innerHTML = "";
		if(gr == 0)
		{
			document.getElementById("graph").style.visibility = "visible";
			document.getElementById("eqn").style.visibility = "visible";
			document.getElementById("myImg").style.visibility = "hidden";
			document.getElementById("fb").style.visibility = "hidden";
			gr = 1;
			for(plott=130;plott<=230;plott++)
			{
				omega1=(2*3.14*(plott))/600;
				h2=(m+m1)*9.81/(omega1*omega1*m*2)*10;//calculates h value
				datapoints1.push({x:h2,y:plott});
			}
	        drawgraph("graph", datapoints1, "height(mm)", "n(rpm)");//Used graph.ob.js and graph_use.ob.js files plot graph	
	    }
	    else if(gr == 1)
	    {
	    	document.getElementById("graph").style.visibility = "hidden";
	    	document.getElementById("eqn").style.visibility = "hidden";
	    	document.getElementById("myImg").style.visibility = "visible";
			document.getElementById("fb").style.visibility = "visible";
	    	gr = 0;
	    	datapoints1.length = 0;//clears the datapoints
	    }
	}
function printcomment()
{
  document.getElementById('commentboxleft').style.width='570px';
  document.getElementById('commentboxleft').innerHTML = "<center>s stands for shaft; change rpm to see the change in height </center>"; 
  // ignore use of deprecated tag <center> . Code is executed only if printcomment function receives inappropriate commentloc value
}

</script>
</body>
</html>